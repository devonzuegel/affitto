(function(){ABM.DatGUI=function(){function t(t,i){ABM.Util.mixin(this,new ABM.Evented),this.gui=new dat.GUI,this.datGuiModel={},this.datGuiControllers={};var e,n,a;2==arguments.length?(e=this.model=t,n=this.ui=i):(a=this.fbui=t,n=this.ui=a.ui),this.initUIElements(n,this.gui)}function i(t){return"undefined"==typeof t.type}return t.prototype.initUIElements=function(t,e){var n=this;for(var a in t)if(t.hasOwnProperty(a)){var s=t[a];if(i(s)){var o=e.addFolder(a);this.initUIElements(s,o);continue}"button"!=s.type&&(this.datGuiModel[a]=s.val,"undefined"!=typeof fbui&&fbui.refs[a].child("val").on("value",function(t){n.datGuiModel[this.name]=t.val(),n.updateGui()}.bind({name:a})));var u=null;switch(s.type){case"button":this.datGuiModel[a]=n.fbui?function(){n.fbui.setUIValue(this.name,!0)}.bind({name:a}):function(){n.setModelValue(this.name,null,this.setter)}.bind({name:a,setter:t[a].setter}),e.add(this.datGuiModel,a);break;case"choice":u=e.add(this.datGuiModel,a,s.vals);break;case"switch":u=e.add(this.datGuiModel,a);break;case"slider":u=e.add(this.datGuiModel,a,s.min,s.max).step(s.step)}if(u){var d;d=n.fbui?function(t){n.fbui.setUIValue(this.name,t)}.bind({name:a}):function(t){n.setModelValue(this.name,t,this.setter)}.bind({name:a,setter:t[a].setter}),s.smooth?u.onChange(d):u.onFinishChange(d),this.datGuiControllers[a]=u}}},t.prototype.setModelValue=function(t,i,e){e?this.model[e](i):this.model[t]=i,this.emit("change",{name:t,value:i})},t.prototype.update=function(t){for(var i in t){var e=this.datGuiControllers[i];if(e){e.setValue(t[i]);var n=e.__onChange||e.__onFinishChange;n(this.datGuiModel[i])}}},t.prototype.updateGui=function(){for(var t in this.gui.__controllers)this.gui.__controllers[t].updateDisplay()},t}()}).call(this);